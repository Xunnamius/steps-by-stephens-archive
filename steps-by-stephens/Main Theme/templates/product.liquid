<div class="product" itemscope itemtype="http://schema.org/Product">
	<meta itemprop="url" content="{{ shop.url }}{{ product.url }}" />
	<meta itemprop="image" content="{{ product | img_url: 'grande' }}" />

	<form action="/cart/add" method="post" enctype="multipart/form-data">
		{% if product.images.size > 1 %}
		<div class="container-fluid mini-lookbook">
		    <div class="row">
		        <div class="lookbook-row-wrapper col-xs-12" data-lookbook-starton="middle">
		            <div class="lookbook-inner-row">
		                {% for image in product.images %}
		                <a href="{{ image | img_url: '1024x1024' }}" class="thumbnail">
		                    <img
		                        src="{{ image | product_img_url: 'medium' }}"
		                        alt="{% if image.alt contains product.title %}{{ product.description }}{% else %}{{ image.alt | escape }}{% endif %}"
		                        data-img-master="{{ image | product_img_url: '1024x1024' }}"
		                    >
		                </a>
		                {% endfor %}
		            </div>
		        </div>
		        <div class="controls">
		            <ul class="pagination">
		                <li>
                            <a
                                href="#"
                                class="scroll-left lookbook-control"
                                data-lookbook-target=".lookbook-row-wrapper"
                                data-lookbook-direction="left"
                            >&laquo;</a>
                        </li>
                        <li>
                            <a
                                href="#"
                                class="scroll-right lookbook-control"
                                data-lookbook-target=".lookbook-row-wrapper"
                                data-lookbook-direction="right"
                            >&raquo;</a>
                        </li>
		            </ul>
		        </div>
		    </div>
		</div>
		{% endif %}
		<div class="container">
			<div class="row">
				<div class="col-xs-12 col-sm-5">
					{% if product.images.size == 0 %}
					<div class="product-photo-container">
						<img src="{{ '' | img_url: 'grande' }}" alt="" class="thumbnail" />
					</div>
					{% else %}
					{% assign featured_image = product.selected_or_first_available_variant.featured_image | default: product.featured_image %}
					<div class="product-photo-container hidden-xs">
						<div class="thumbnail">
							<img src="{{ featured_image | img_url: 'grande' }}" alt="{{ product.title | escape }}" />
						</div>
					</div>
					{% endif %}
				</div>
				<div class="col-xs-12 col-sm-5 col-sm-offset-2">
					<div class="product-details">
						<div class="row">
							<div class="col-xs-12">
								<h1 itemprop="name">{{ product.title }}</h1>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12">
								<div id="product-description" class="rte" itemprop="description">
									{{ product.description }}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-12">
								{% assign hide_default_title = false %}
								{% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
								{% assign hide_default_title = true %}
								{% endif %}

								<div id="product-variants" class="{% if hide_default_title %} hidden{% endif %}">
									<select id="product-select" name="id">
										{% for variant in product.variants %}
										<option{% if variant == product.selected_or_first_available_variant %} selected{% endif %} value="{{ variant.id }}">
										{{ variant.title }} - {{ variant.price | money }}
										</option>
										{% endfor %}
									</select>
								</div>        

								<div id="backorder" class="hidden">
									<p>{{ '%s is back-ordered. We will ship it separately in 10 to 15 days.' | replace: '%s', '<span id="selected-variant"></span>' }}</p>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-xs-4">
								{% if collection %}
								{% if collection.previous_product %}
								{% capture prev_url %}{{ collection.previous_product}}#content{% endcapture %}
								<span class="pull-left">{{ '&larr; Previous Product' | link_to: prev_url }}</span>
								{% endif %}
								{% endif %}
							</div>
							<div class="col-xs-4 text-align-centered">
								<div id="product-price" itemprop="offers" itemscope itemtype="http://schema.org/Offer" class="delta">
									<meta itemprop="priceCurrency" content="{{ shop.currency }}" />
									{% if product.available %}
									<link itemprop="availability" href="http://schema.org/InStock" />
									{% else %}
									<link itemprop="availability" href="http://schema.org/OutOfStock" />
									{% endif %}

									<p>
										{% assign variant = product.selected_or_first_available_variant %}
										{% if product.compare_at_price > product.price %}
										<span class="product-price on-sale" itemprop="price">{{ variant.price | money }}</span>
										<s class="product-compare-price">{{ variant.compare_at_price | money }}</s>
										{% else %}
										<span class="product-price" itemprop="price">{{ variant.price | money }}</span>
										{% endif %}
									</p>
								</div>
								<div id="product-add">
									<input type="submit" name="add" id="add" class="primary button" value="Add to Cart">
								</div>
							</div>
							<div class="col-xs-4">
								{% if collection %}
								{% if collection.next_product %}
								{% capture next_url %}{{ collection.next_product}}#content{% endcapture %}
								<span class="pull-right">{{ 'Next Product &rarr;' | link_to: next_url }}</span>
								{% endif %}
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% comment %}
		All themes by Shopify should support the Product Reviews app out of the box.
		https://apps.shopify.com/product-reviews
		{% endcomment %}
		<div id="shopify-product-reviews" data-id="{{ product.id }}">{{ product.metafields.spr.reviews }}</div>
	</form>
</div>

{% comment %}
  Adding support for product options. See here for details:  
  http://docs.shopify.com/support/your-website/themes/can-i-make-my-theme-use-products-with-multiple-options
{% endcomment %}

<script>
var selectCallback = function(variant, selector) {
  if (variant) {
	// Swap image.
	if (variant.featured_image) {
	  var newImage = variant.featured_image; // New image object.
	  var mainImageDomEl = jQuery('.product-photo-container img')[0]; // DOM element of main image we need to swap.
	  Shopify.Image.switchImage(newImage, mainImageDomEl, switchImage); // Define switchImage (the callback) in your theme's JavaScript file.
	}

	// Selected a valid variant that is available.
	if (variant.available) {
	  // Enabling add to cart button.
	  jQuery('#add').removeClass('disabled').prop('disabled', false).val('Add to Cart').fadeTo(200,1);
	
	  // If item is backordered yet can still be ordered, we'll show special message.
	  if (variant.inventory_management && variant.inventory_quantity <= 0) {
		jQuery('#selected-variant').html({{ product.title | json }}{% unless hide_default_title %} + ' - ' + variant.title{% endunless %});
		jQuery('#backorder').removeClass("hidden");
	  } else {
		jQuery('#backorder').addClass("hidden");
	  }
	} else {
	  // Variant is sold out.
	  jQuery('#backorder').addClass('hidden');
	  jQuery('#add').val('Sold Out').addClass('disabled').prop('disabled', true).fadeTo(200,0.5);        
	}
	
	// Whether the variant is in stock or not, we can update the price and compare at price.
	if ( variant.compare_at_price > variant.price ) {
	  jQuery('#product-price').html('<span class="product-price on-sale">'+ Shopify.formatMoney(variant.price, "{{ shop.money_format }}") +'</span>'+'&nbsp;<s class="product-compare-price">'+Shopify.formatMoney(variant.compare_at_price, "{{ shop.money_format }}")+ '</s>');
	} else {
	  jQuery('#product-price').html('<span class="product-price">'+ Shopify.formatMoney(variant.price, "{{ shop.money_format }}") + '</span>' );
	}        

  } else {
	// variant doesn't exist.
	jQuery('#backorder').addClass('hidden');
	jQuery('#add').val('Unavailable').addClass('disabled').prop('disabled', true).fadeTo(200,0.5);
  }
};
  
jQuery(function($) {
  new Shopify.OptionSelectors('product-select', { product: {{ product | json }}, onVariantSelected: selectCallback, enableHistoryState: true });
  
  // Add label if only one product option and it isn't 'Title'.
  {% if product.options.size == 1 and product.options.first != 'Title' %}
	$('.selector-wrapper:eq(0)').prepend('<label>{{ product.options.first }}</label>');
  {% endif %}

});

Shopify.Image.preload({{ product.images | json }}, 'grande');
Shopify.Image.preload({{ product.images | json }}, '1024x1024');
</script>
